


require("dotenv").config(); // env variables
const sendinblue = axios.create({
  baseURL: "https://api.sendinblue.com/v3",
  headers: {
    "api-key": process.env.SENDINBLUE_API_KEY,
  },
  timeout: 10000,
});

creating a contact
sendinblue
    .post("/contacts", {
      email: req.body.email,
      attributes: {
        token: auth,
      },
      listIds: [5],
      updateEnabled: false,
    })
    .then((response) => {
      res.sendStatus(201);
      console.log("contact created");
    })
    .catch((error) => {
      if (error.response) {
        console.log(error.response.status);
        console.log(error.response.data);
      } else if (error.request) {
        console.log(error.request.status);
        console.log(error.request.data);
      }
      res.sendStatus(500);
    });


creating a contact with double doubleOptinConfirmation
sendinblue
    .post("/contacts/doubleOptinConfirmation", {
      email: req.body.email,
      attributes: {
        token: auth
      },
      includeListIds: [5],
      templateId:[1],
      redirectionUrl: auth,
      updateEnabled: false,
    })
    .then((res) => {
      console.log(res.data);
    })
    .catch((err) => {
      console.log(err.status, err.data);
    });

    sending a normal transactional email directly
    sendinblue
    .post("/smtp/email", {
      sender: {
        name: "Mavnew Contact Form",
        email: "no-reply@mavnew.com",
      },
      to: [{ email: "rosaryfirm@gmail.com" }],
      htmlContent: `<h3>Sender name and email: ${req.body.contactName} & ${req.body.contactEmail}</h3><p>${req.body.contactMessage}</p>`,
      textContent: `Sender name and email: ${req.body.contactName} & ${req.body.contactEmail}.        ${req.body.contactMessage}`,
      subject: req.body.contactSubject || "No subject",
      replyTo: { email: req.body.contactEmail, name: req.body.contactName },
    })
    .then(() => {
      req.flash(
        "success",
        "Your message has been sent, we will get back to you shortly."
      );
      res.redirect("/contact");
    })
    .catch((error) => {
      req.flash(
        "error",
        "Error: Your message failed to send!! Please try again later."
      );
      res.redirect("/contact");
      console.log(error);
    });


    app.use((req, res, next) => {
  //not sure if this https redirect middleware will slow down the server. I'm thinking it might, so keep eye here incase error or slow performance happens
  if (
    (!req.secure || req.hostname === "www.mavnew.com") &&
    process.env.NODE_ENV === "prod"
  ) {
    return res.redirect(
      301,
      `https://mavnew.herokuapp.com${req.originalUrl}`
    );
  }
  next();
});

<a href="https://www.amazon.com/Exerpeutic-Foldable-Exercise-Weight-Capacity/dp/B081P4CJLF/ref=as_li_ss_il?ie=UTF8&linkCode=li2&tag=mavnew-20&linkId=6efdc28c5424e404909252c6d31c7ae1&language=en_US" target="_blank"><img border="0" src="//ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B081P4CJLF&Format=_SL160_&ID=AsinImage&MarketPlace=US&ServiceVersion=20070822&WS=1&tag=mavnew-20&language=en_US" ></a><img src="https://ir-na.amazon-adsystem.com/e/ir?t=mavnew-20&language=en_US&l=li2&o=1&a=B081P4CJLF" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />