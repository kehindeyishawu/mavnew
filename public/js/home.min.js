const header = document.querySelector("#header");
const cursor = document.querySelector("#move-up");
const newsletter = document.querySelector("#footer form");
const formField = document.querySelector("#footer input");

axios.defaults.timeout = 5000;

const obsever = new IntersectionObserver((entries, obsever) => {
  entries.forEach((e) => {
    if (e.target === header && e.isIntersecting) {
      cursor.classList.add("disappear");
    }
    if (e.target === header && !e.isIntersecting) {
      cursor.classList.remove("disappear");
    }
  });
}, {});

obsever.observe(header);

newsletter.onsubmit = () => {
  if (!formField.hasAttribute("required")) {
    console.log("Think you smart huh!!!");
    return false;
  }
  document.querySelector("#footer button").innerHTML =
    "<div class='spinner-border spinner-border-sm' role='status'><span class='sr-only'>loading...</span><div>";
  axios
    .post("/api/newsletter", {
      email: formField.value,
    })
    .then((res) => {
      console.log(res);
      newsletter.outerHTML = `A confirmation email has been sent to your inbox`;
    })
    .catch((err) => {
      newsletter.outerHTML =
        "<span class='text-danger'>Subscription failed!! try again later</span>";
      if (err.response) {
        console.log(err.response.status);
        console.log(err.response.header);
      } else if (err.request) {
        console.log(err.resquest.status);
        console.log(err.resquest.data);
        console.log(err.resquest.header);
      } else {
        console.log(err.message);
      }
    });
  return false;
};
